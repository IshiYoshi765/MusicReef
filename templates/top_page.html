<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://use.fontawesome.com/releases/v5.15.3/css/all.css" rel="stylesheet"/>
  <link rel="icon" href="{{url_for('static', filename='favicon/mrãƒ­ã‚´.ico')}}"/>
  <link rel="stylesheet" href="{{url_for('static', filename='/css/search_top.css')}}">
  <title>åˆ©ç”¨è€…ãƒˆãƒƒãƒ—</title>
</head>
<body>
  <ul class="topnav">
    <li>
      <a class="left" href="{{url_for('user_top')}}"><h2>ã€€MUSIC REEF</h2></a>
    </li>
    <li class="right">
      <a
        href="{{url_for('terms_of_service')}}"
        style="
          border-left: 2px solid white;
          padding: 2px 8px;
        "
      ><h2>åˆ©ç”¨è¦ç´„</h2></a>
    </li>
  </ul>
  <div style="background-color: #ececec; margin: 0; height: 120px">
    <h3 class="title1">ãƒ•ãƒªãƒ¼éŸ³æºã®æ¤œç´¢</h3>
    <div class="search-box">
      <form action="{{url_for('search_music_result')}}" method="post">
        <select name="genre">
            <option value="">æŒ‡å®šã—ãªã„</option>
            <option value="2">ãƒãƒƒãƒ—</option>
            <option value="3">EDM</option>
            <option value="4">ãƒ­ãƒƒã‚¯</option>
            <option value="5">ã‚¯ãƒ©ã‚·ãƒƒã‚¯</option>
            <option value="6">å’Œé¢¨</option>
            <option value="7">ãƒ”ã‚¢ãƒ</option>
            <option value="8">ã‚¢ãƒ³ãƒ“ã‚¨ãƒ³ãƒˆ</option>
            <option value="9">ã‚¨ãƒ¬ã‚¯ãƒˆãƒ­</option>
            <option value="10">ã‚¢ã‚³ãƒ¼ã‚¹ãƒ†ã‚£ãƒƒã‚¯</option>
            <option value="11">Chill Hop</option>
        </select>      

          <input type="text" class="tagInput" placeholder="æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰" name="name">
          <input type="hidden" name="page" value="{{ page }}"> 
              <button type="submit">
                <i class="fas fa-search fa-fw"></i>
              </button>      
        </form>
    </div>
  </div>

  <div class="expression">
    <p class="p1">music search</p>
    <h3 class="title2">ä¸¦ã³æ›¿ãˆ</h3>
      <select class="sort" name="item">
        <option value="item1">æŒ‡å®šã—ãªã„</option>
          <option value="item2">æ–°ã—ã„</option>
          <option value="item3">å¤ã„</option>
          <option value="item4">ã‚¢ã‚¯ã‚»ã‚¹æ•°</option>
          <option value="item5">äº”åéŸ³é †</option>
          <option value="item6">è©•ä¾¡ãŒé«˜ã„</option>
      </select>
      <h3 class="title3">éŸ³æºæ™‚é–“</h3>
        <select class="music-length" name="length">
          <option value="">æŒ‡å®šã—ãªã„</option>
          <option value="0">~0:59</option>
          <option value="1">1:00~1:59</option>
          <option value="2">2:00~2:59</option>
          <option value="3">3:00~3:59</option>
          <option value="4">4:00~4:59</option>
          <option value="5">5:00~5:59</option>
          <option value="6">6:00~</option>
        </select>
      <h3 class="title4">ã‚µã‚¤ãƒˆ</h3>
        <select class="site" name="item">
            <option value="" >æŒ‡å®šã—ãªã„</option>
            <option value="1" >DOVA</option>
            <option value="2" >BGMer</option>
            <option value="3" >ç”˜èŒ¶ã®éŸ³æ¥½å·¥æˆ¿</option>
            <option value="4" >MusMus</option>
            <option value="5" >SHW</option>
        </select>
        
    
    <p class="p2">æ¤œç´¢çµæœ</p>

    <ul>
      {% if music_list %}
        {% for music in music_list %}
        <div id="music-length-data" data-length ="{{music[5]}}" >
        <div id="music-site-data" data-site = "{{ music[7] }}">
          <li class="music-entry">
            <div class="logo-container">
              {% set logo_keyword = music[8]|lower %}
              {% if 'bgmer' in logo_keyword %}
                <img class="logo-img" src="{{ url_for('static', filename='img/BGMer.jpg') }}" alt="BGMer ãƒ­ã‚´">
              {% elif 'amachamusic' in logo_keyword %}
                <img class="logo-img" src="{{ url_for('static', filename='img/amatya.jpg') }}" alt="Amatya ãƒ­ã‚´">
              {% elif 'dova-s.jp' in logo_keyword %}
                <img class="logo-img" src="{{ url_for('static', filename='img/dova.jpg') }}" alt="Dova ãƒ­ã‚´">
              {% elif 'musmus.main.jp' in logo_keyword %}
                <img class="logo-img" src="{{ url_for('static', filename='img/MusMus.jpg') }}" alt="MusMus ãƒ­ã‚´">
              {% elif 'shw.in' in logo_keyword %}
                <img class="logo-img" src="{{ url_for('static', filename='img/SHW.jpg') }}" alt="SHW ãƒ­ã‚´">
              {% else %}
                <div class="no-image">ç”»åƒãªã—</div>
              {% endif %}
            </div>
            <div class="music-info-container">
              <p class="music_title">{{ music[1] }}</p>
              <p class="music-info">ä½œæ›²: {{ music[6] }}</p>
              <p class="music-info">â™¬ {{ music[4] }}</p>
              <p class="music-info">
                {% set genre_options = {
                  '1': 'æŒ‡å®šã—ãªã„',
                  '2': 'ãƒãƒƒãƒ—',
                  '3': 'EDM',
                  '4': 'ãƒ­ãƒƒã‚¯',
                  '5': 'ã‚¯ãƒ©ã‚·ãƒƒã‚¯',
                  '6': 'å’Œé¢¨',
                  '7': 'ãƒ”ã‚¢ãƒ',
                  '8': 'ã‚¢ãƒ³ãƒ“ã‚¨ãƒ³ãƒˆ',
                  '9': 'ã‚¨ãƒ¬ã‚¯ãƒˆãƒ­',
                  '10': 'ã‚¢ã‚³ãƒ¼ã‚¹ãƒ†ã‚£ãƒƒã‚¯',
                  '11': 'Chill Hop',
                } %}
                {{ genre_options[music[2]] }}
              </p>
              <p class="music-info">ğŸ‘ {{ music[11] }}å›</p>
              <div class="detail-cursor" data-music-id="{{ music[0] }}">è©³ç´°ãªæƒ…å ±</div>
              <div class="music-details-container" id="music-details-{{ music[0] }}">
                <div class="details-box">
                  <div class="tooltip"></div>
                  {% if music[12] != None %}
                    <p>{{ music[12] }}</p>
                  {% else %}
                    <p>åˆ©ç”¨å¯èƒ½ãªã‚¿ã‚°ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
                  {% endif %}
                  <br>
                  <p>{{ music[3] }}</p>
                  <br>
                </div>
              </div>
            
              <a href="{{ url_for('review', music_id=music[0]) }}" class="review">
                è©•ä¾¡<br>
                {% if average_ratings and music[0] in average_ratings %}
                  <span>{{ average_ratings[music[0]] | round(1) }}/5</span>
                {% else %}
                  <span>-/5</span>
                {% endif %}
              </a>
              <a class="download-action">
                {% if music[8] %}
                  <a href="{{ url_for('download_music', music_id=music[0]) }}" class="download-link">ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>
                {% else %}
                  <span>N/A</span>
                {% endif %}
              </a>
            </div>
          </li>
        </div>
        </div>
        {% endfor %}
      {% endif %}
    </ul>

    <div class="pagination">

    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var detailCursors = document.querySelectorAll(".detail-cursor");

        detailCursors.forEach(function (cursor) {
          cursor.addEventListener("mouseover", function () {
            var musicId = this.getAttribute("data-music-id");
            var musicDetails = document.getElementById(
              "music-details-" + musicId
            );
            var tooltip = musicDetails.querySelector(".tooltip");
            var detailsBox = musicDetails.querySelector(".details-box");

            if (musicDetails) {
              var rect = this.getBoundingClientRect();
              musicDetails.style.display = "block";

              detailsBox.style.display = "block";
            }
          });

          cursor.addEventListener("mouseout", function () {
            var musicId = this.getAttribute("data-music-id");
            var musicDetails = document.getElementById(
              "music-details-" + musicId
            );
            var tooltip = musicDetails.querySelector(".tooltip");
            var detailsBox = musicDetails.querySelector(".details-box");

            if (musicDetails) {
              musicDetails.style.display = "none";
              tooltip.style.display = "none";
              detailsBox.style.display = "none";
            }
          });
        });
      });

      
    /*  document.addEventListener("DOMContentLoaded", function () {
        var items = document.querySelectorAll('.music-entry');
        var itemsPerPage = 30;
        var currentPage = {{ page }};
      
        function showPage(page) {
          var startIndex = (page - 1) * itemsPerPage;
          var endIndex = startIndex + itemsPerPage;
      
          for (var i = 0; i < items.length; i++) {
            items[i].style.display = (i >= startIndex && i < endIndex) ? 'flex' : 'none';
          }
        }
      
        function updatePagination(totalItems) {
          var totalPages = Math.ceil(totalItems / itemsPerPage);
          var paginationContainer = document.querySelector('.pagination');
          paginationContainer.innerHTML = '';
      
          if (totalPages > 1) {
            var prevPageLink = document.createElement('a');
            prevPageLink.href = '{{ url_for('search_music_result', genre=genre, name=name) }}' + '?page=' + (currentPage - 1);
            prevPageLink.textContent = 'ï¼œï¼œ å‰ã®ãƒšãƒ¼ã‚¸';
            prevPageLink.addEventListener('click', function (event) {
              event.preventDefault();
              var newPage = currentPage - 1;
              if (newPage < 1) {
                newPage = 1;
              }
              showPage(newPage);
            });
            paginationContainer.appendChild(prevPageLink);
      
            for (var pageNum = 1; pageNum <= totalPages; pageNum++) {
              var pageLink = document.createElement('a');
              pageLink.href = '{{ url_for('search_music_result', genre=genre, name=name) }}' + '?page=' + pageNum;
              pageLink.textContent = pageNum;
      
              pageLink.addEventListener('click', function (event) {
                event.preventDefault();
                var clickedPage = parseInt(this.textContent, 10);
                showPage(clickedPage);
              });
      
              if (pageNum === currentPage) {
                pageLink.classList.add('current');
              }
      
              paginationContainer.appendChild(pageLink);
            }
      
            if (currentPage < totalPages) {
              var nextPageLink = document.createElement('a');
              nextPageLink.href = '{{ url_for('search_music_result', genre=genre, name=name) }}' + '?page=' + (currentPage + 1);
              nextPageLink.textContent = ' æ¬¡ã®ãƒšãƒ¼ã‚¸ ï¼ï¼';
              nextPageLink.addEventListener('click', function (event) {
                event.preventDefault();
                showPage(currentPage + 1);
              });
              paginationContainer.appendChild(nextPageLink);
            }
          }
        }
      
        function filterAndSortMusic() {
          var musicLength = document.querySelector('.music-length').value;
          var selectedSite = document.querySelector('.site').value;
          var filteredItems = [];
      
          for (var i = 0; i < items.length; i++) {
            var musicLengthData = document.querySelectorAll('#music-length-data');
            var musicLengthNumber = musicLengthData[i].dataset.length;
      
            var musicSiteData = document.querySelectorAll('#music-site-data');
            var musicDataNumber = musicSiteData[i].dataset.site;
      
            var siteMatch = (selectedSite === '' || selectedSite === musicDataNumber);
            var lengthMatch = (musicLength === '' || musicLength === musicLengthNumber);
      
            if (siteMatch && lengthMatch) {
              filteredItems.push(items[i]);
            }
          }
      
          updatePagination(filteredItems.length);
          showPage(1); // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å¾Œã«æœ€åˆã®ãƒšãƒ¼ã‚¸ã‚’è¡¨ç¤º
        }
      
        document.querySelector('.music-length').addEventListener('change', filterAndSortMusic);
        document.querySelector('.site').addEventListener('change', filterAndSortMusic);
      
        // åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        updatePagination(items.length);
        showPage(currentPage);
      });
      */
    </script>

<br>     

  <div class="footer04">
    <h1>MUSIC REEF</h1>
    <ul class="menu">
      <li><a href="#">ãƒ›ãƒ¼ãƒ </a></li>
      <li>
        <a href="about_the_site.html">MUSIC REEF(ãƒŸãƒ¥ãƒ¼ã‚¸ãƒƒã‚¯ãƒªãƒ¼ãƒ•)ã«ã¤ã„ã¦</a>
      </li>
    </ul>
  </div>
  <script type="text/javascript" src="{{ url_for('static', filename='/js/narrow.js') }}"></script>
</body>
</html>